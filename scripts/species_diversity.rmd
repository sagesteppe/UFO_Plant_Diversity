---
title: "Plant Species Diversity"
author: NULL
date: NULL
output:
  pdf_document: default
  word_document: default
header-includes:
 - \usepackage[width=\textwidth]{caption}
always_allow_html: yes
csl: ../citations/citations/apa.csl
bibliography: ../citations/citations/citations.bib
link-citations: yes
---

Diversity, which after evolution - a process inextricably linked to it, may be the penultimate topic of interest in the Natural Sciences. Diversity, the variety of form and features in each dimension of our existences, extends in myriad directions. The diversity of the natural world is recognizable to the non-specialist as a variety of habitats, *physiognomic* types of plants, and oftentimes species. The diversity of organisms may be recognized by specialists with the use of their tools to detect the presence of genes in species, and the copies of variants of these genes. Accordingly a whole slew of metrics to measure and discuss diversity exist. In this section we discuss two very simple forms of diversity.

*Alpha-diversity* - or species richness, is simply the number of species in a space at a point in time. The scale at which we discuss $\alpha  -diversity$ is usually up to a few footballs in size. This metric refers to areas which we are intimately familiar with and may traverse readily on foot. *Gamma-Diversity*, represents the richness of species in a larger area, generally a landscape. For example, we may readily discuss the $\gamma-diversity$ of the Dominguez-Escalente National Monument. In all instances the alpha diversity of many sites are nested within the gamma diversity of an area. Gamma diversities -in this case the number of species- exceed those of alpha diversities, both due to the relative uncommonness of many species, these uncommon species are often not present across the entirety of the landscape, and due to the large changes in the type of species supported by the habitats. These turnovers across the alpha diversity of sites, the difference in species present at sites, comprise *beta-diversity*. High rates of $\beta-diversity$, or dissimilarity of sites, foster high rates of gamma-diversity. We will not discuss it in depth here (@whittaker1972evolution).

Evolution, the process largely mediating the maintenance of diversity, is survival of the fittest. However, the conditions of the test which may constitute the 'fittest' are nearly as numerous as the forms of diversity. Many species which exist in the same location in space, have distinct characteristics which allow for them to persist; dry years favor some species, while wet years favor others, some require more sun, while others thrive with less, the permutations and combinations of these settings go on *ad nauseum*. **The cover of these species ebb and flow with the usual weather and disturbances within the climate zone of the site (@hoover2014resistance, ...). These trends are especially important for the production of forage and browse, over the life of most large animals, they will have to feed on what they have available. No single species is the fittest at a site on a time scale which the BLM manages land, having multiple species which function similarly in space is the only stable strategy for management. **

While Ecological Site Descriptions do not provide true measures of $\alpha-diversity$ - a list of all taxa which may grow at a site - many of them do contain lists of taxa which may be considered *dominant* or *subordinate* at a site (@avolio2019demystifying, @grime1998benefits). In general, it seems that the Shrubs, Trees, and Grasses at an Ecological Site would be considered *dominant*, and the forbs *subordinate*; keep in mind these terms refer to immediate ecosystem cycling effects, and the services offered by forbs to insects and then larger animals remain substantial (@avolio2019demystifying). These species which have high amounts of biomass, and ground cover, may be thought of as a core groups of species which are essential for the functioning of an ecosystem (@grime1998benefits), and each of the dominant species have been theorized to have conceptual effects as large as their cover. When dominant and subordinate species are lost from an area, it also has effects on the remaining species - most of which are relatively uncommon across the landscape (@grime1998benefits, @whittaker1965dominance). Considerable research has shown that having a diverse suite of plant species allows areas to: 1) Produce more forage in both a single year, and across different weather scenarios (@vogel2012grassland, @hoover2014resistance), 2) recover from disturbances such as fire, or compaction (@tilman1994biodiversity) 3) and resist degradation such as from the encroachment of noxious weeds (@weisser2017biodiversity, @avolio2019demystifying, @allan2011more, @gaitan2014vegetation, @sheley2010resistance, @isbell2011high, @oakley2013plant, *and reviewed in* @maestre2016structure, @oliver2015biodiversity). 

Recruitment of native species back following drought may have issues pertaining to seed recruitment... @tilman1992drought .. although soil seeds banks in arid systems well.

Given the generally high % abundance of the taxa listed in the species tables ESD's it is unlikely that they are truly lost, and should at least show in species richness meanders which have higher probability of uncovering more microhabitats, areas which individuals may have more access to water or other 


@hooper2005effects


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(dpi = 300) 
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(warning = F)
```

Information on production at Ecological Sites implies some superficial, yet essential, components of plant diversity. 

### run analyses for both LPI and SR, most of these things are pretty much dirt common and should be found on lines without much hassle !?

```{r}
library(tidyverse)
```


```{r paths and files}
praw <- '../data/raw'
ppro <- '../data/processed'
f <- list.files(praw, pattern = 'csv')
fp <- list.files(ppro, pattern = 'csv')
```


```{r Import Data for both Species Richness and LPI, eval = F}

aim_rich <- read.csv(file.path(ppro, fp[grep('AIM_Rich', fp)]))
aim_lpi <- read.csv(file.path(ppro, fp[grep('AIM_LPI', fp)]))

esds <- read.csv(file.path(praw, f[grep('Plot.*ESD', f)])) %>% drop_na()

# aim_data <-  # CREATE BOOLEAN COLUMN, 1 = ON LPI, 0 - MISSING FROM LPI - 

```


```{r Lookup Grass and Shrub Status}
photosynthetic <- read.csv(file.path(praw, f[grep('Photo.*RCB', f)])) %>% 
  mutate(PHOTOSYNTHETIC = if_else(str_detect(PHOTOSYNTHETIC, 'C3'), 'C3', 'C4' )) 

shrub_sprout <- read.csv(file.path(ppro, files[grep('Shrub', files)])) %>% 
  bind_rows(., read.csv(file.path(praw, f[grep('shrubs_resprout', f)]))) %>% 
  select(SYMBOL, RESPROUT) %>% 
  mutate(RESPROUT = if_else(RESPROUT == 'Yes', 'RESPROUT', 'NON-RESPROUT'))

richness <- richness %>%  
  left_join(., photosynthetic, by = 'SYMBOL') %>% 
  left_join(., shrub_sprout, by = 'SYMBOL')
  
rm(photosynthetic, shrub_sprout)
```

```{r Lookup Forb Life Cycle}

life_cycle <- read_csv(file.path(praw, f[grep('export', f)]), show_col_types = F) %>%
  filter(USDA_GrowthHabitSimple == 'Forb', FQA_USDASymbol != 'GUSA2') %>% 
  select(SYMBOL = FQA_USDASymbol, NATIVITY = FQA_NativeStatus, LIFECYCLE = USDA_Duration) %>% 
  mutate(LIFECYCLE = case_when(
    LIFECYCLE == 'Biennial, Perennial' ~ 'Perennial', 
    LIFECYCLE == 'Annual, Biennial' ~ 'Annual', 
    LIFECYCLE == 'Annual, Biennial, Perennial' ~ 'Any',
    TRUE ~ as.character(LIFECYCLE)
  ))

```

```{r Create Finer Functional Groups}

richness <- richness %>% 
  relocate(any_of(c("PHOTOSYNTHETIC", "RESPROUT", "LIFECYCLE", "FUNCTIONAL")), 
           .after = last_col()) %>% 
  unite(col = FUNCTIONAL_FINE, PHOTOSYNTHETIC:FUNCTIONAL, 
        sep = "-", na.rm = T, remove = F) %>% 
  select(-PHOTOSYNTHETIC, -RESPROUT)

```

```{r append nativity information}

nativity <- read.csv(file.path(ppro, files[grep('Native', files)])) %>% 
  select(SYMBOL, LIFECYCLE = DURATION, NATIVITY) %>% 
  mutate(across(.cols = everything(), ~ str_to_upper(.))) %>% 
  mutate(LIFECYCLE = case_when(
    LIFECYCLE == 'BIENNIAL, PERENNIAL' ~ 'PERENNIAL', 
    LIFECYCLE == 'ANNUAL, BIENNIAL' ~ 'ANNUAL', 
    LIFECYCLE == 'ANNUAL, PERENNIAL' ~ 'ANY',
    LIFECYCLE == 'ANNUAL, BIENNIAL, PERENNIAL' ~ 'ANY',
    TRUE ~ as.character(LIFECYCLE)
  )) 

richness <- left_join(richness, nativity, by = 'SYMBOL') %>% 
  unite(LIFECYCLE, c(LIFECYCLE.x, LIFECYCLE.y), na.rm = T) %>% 
  unite(NATIVITY, c(NATIVITY.x, NATIVITY.y), na.rm = T) %>% 
  mutate(across(.cols = c(LIFECYCLE, NATIVITY), ~ str_remove_all(.x, '_.*')))

```

```{r Filter Reference Datasets, eval = F}

richness <- read.csv(file.path(praw, f[grep('Associations', f)])) %>% 
  filter(PHASE == '1.1', str_length(SYMBOL) >= 4)  

# this where production > 0 - represents expected richness for a site
production_zero <- richness %>% 
  filter(LOWER > 0) %>% 
  group_by(ECO.SITE, STATE, FUNCTIONAL) %>% 
  count()   

production <- richness %>% # this with 0 production - 
  # represents all core gamma richness by ESD ??
  group_by(ECO.SITE, STATE, FUNCTIONAL) %>% 
  count()


# How many plots meet A for each standard ? And where do they sit relative to B ?

richness <- 

# Let us split out Grass, into C3, C4, and annual - three categories
# perhaps also split out Shrub into (resprout) and (non-resprout) 


# let us split out forbs into native and non-native
# Create a facet wrap of each major functional group
# - Shrub (resprout), Shrub (non-resprout),  - and then colour by ESD group.

# so cols = TREE, SHRUB (NS), SHRUB (S), PG - C3, PG - C4, AG, PERENNIAL FORB, ANNUAL FORB,   

```




```{r gather estimate of number of species in functional groups}

dominant_plants <- read.csv(file.path(ppro, fp[grep('Associations', fp)])) %>% 
  filter(PHASE == '1.1', str_length(SYMBOL) >= 4)  

# this where production > 0 - represents expected richness for a site
production_zero_func_1 <- richness %>% 
  filter(LOWER > 0) %>% 
  group_by(ECO.SITE, STATE, FUNCTIONAL) %>% 
  count()   

production_potential_func_1 <- richness %>% # this with 0 production - 
  # represents all core gamma richness by ESD ??
  group_by(ECO.SITE, STATE, FUNCTIONAL) %>% 
  count()

production_zero_func_2 <- richness %>% 
  filter(LOWER > 0) %>% 
  group_by(ECO.SITE, STATE, FUNCTIONAL_FINE) %>% 
  count()   

production_potential_func_2 <- richness %>% # this with 0 production - 
  # represents all core gamma richness by ESD ??
  group_by(ECO.SITE, STATE, FUNCTIONAL_FINE) %>% 
  count()
```

```{r Join Homebrewed ESD groups to Ecological Site Descriptions}

esdM <- read.csv(file.path(praw, f[grep('modules', f)]))

```


```{r Boxplots of different ESG with ESDs and reference standards}

# ! colour the Facet panel backgrounds by this!!!!!!!!
cols <- colorspace::qualitative_hcl(9, palette = "Dark 3") # these for matching with the species diversity. 

```


```{r clean environment}

```



# References


